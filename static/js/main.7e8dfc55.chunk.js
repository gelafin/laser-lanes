(this["webpackJsonplaser-lanes"]=this["webpackJsonplaser-lanes"]||[]).push([[0],{19:function(t,e,i){},20:function(t,e,i){"use strict";i.r(e);var a=i(0),s=i(3),n=i.n(s),l=i(12),r=i.n(l),h=i(2),c=i(8),o=i(6),p=(i(9),i(4)),u=i(5),g=i(1),d=i(11),S=i(10);i(19);function y(t,e){return Math.floor(Math.random()*(e-t))+t}function f(t){var e="https://live.staticflickr.com/65535/50724769872_da72a3fd7c_t.jpg",i="https://live.staticflickr.com/65535/50724684336_aaa14d5649_t.jpg";return!t.isAlly&&t.isAlive?Object(a.jsxs)("div",{className:"ship",children:[Object(a.jsx)("img",{src:t.isAlly?i:e}),Object(a.jsx)(v,{isAlly:!1,laserState:t.state})]}):!0===t.isAlive?Object(a.jsxs)("div",{className:"ship",children:[Object(a.jsx)(v,{isAlly:!0,laserState:t.state}),Object(a.jsx)("img",{src:t.isAlly?i:e})]}):Object(a.jsx)("div",{className:"ship"})}function v(t){var e,i=t.laserState,s=t.isAlly;if("charging"===i)e=s?"https://live.staticflickr.com/65535/50723947808_35ba1cd9e7_o.png":"https://live.staticflickr.com/65535/50724684381_4ca6f500da_t.jpg";else{if("firing"!==i)return Object(a.jsx)("div",{className:"laser"});e=s?"https://live.staticflickr.com/65535/50724684431_e854d32aa9_o.png":"https://live.staticflickr.com/65535/50723947768_2ab5054c24_t.jpg"}return Object(a.jsx)("img",{src:e,className:"laser"})}function m(t){var e=Object.values(t.ships).map((function(t){return Object(a.jsx)(f,{isAlly:t.isAlly(),isAlive:t.isAlive(),state:t.getState()},t.getId())}));return Object(a.jsx)("ul",{className:"game-row",children:e})}function b(t){var e=t.output,i=Array.from(e),s=t.reactKeys.values(),n=i.map((function(t,e){return Object(a.jsx)("div",{column:e,children:t},s.next().value)}));t.outputCharKeys;return Object(a.jsx)("div",{className:"output-container",children:Object(a.jsx)("ul",{className:"game-text game-row",children:n})})}var j=function(t){Object(d.a)(i,t);var e=Object(S.a)(i);function i(t){var a;return Object(p.a)(this,i),(a=e.call(this,t)).handleChange=a.handleChange.bind(Object(g.a)(a)),a}return Object(u.a)(i,[{key:"handleChange",value:function(t){this.props.onInputChange(t.target.value)}},{key:"render",value:function(){return Object(a.jsx)("form",{className:"input-container game-text-container flex-container",children:Object(a.jsx)("input",{type:"text",value:this.props.input,className:"input-box game-text",onChange:this.handleChange})})}}]),i}(n.a.Component);var O=function(){function t(e,i){Object(p.a)(this,t),this.alive=!0,this.state="idle",this.lane=i,this.ally=e;var a=e?"ally":"enemy";this.id=a+i.toString()}return Object(u.a)(t,[{key:"getState",value:function(){return this.state}},{key:"getId",value:function(){return this.id}},{key:"getLane",value:function(){return this.lane}},{key:"isAlly",value:function(){return this.ally}},{key:"isAlive",value:function(){return this.alive}},{key:"destroy",value:function(){this.alive=!1}},{key:"print",value:function(){console.log("\tid:",this.getId()),console.log("\tisAlly:",this.isAlly()),console.log("\tlane:",this.getLane()),console.log("\tstate:",this.getState()),console.log("\talive:",this.isAlive())}},{key:"advanceState",value:function(){return"idle"===this.state?this.state="charging":"charging"===this.state?this.state="firing":this.state="idle",this.state}},{key:"retire",value:function(){this.state="retired"}}]),t}();var k=function(t){Object(d.a)(i,t);var e=Object(S.a)(i);function i(t){var a;Object(p.a)(this,i);return(a=e.call(this,t)).maxColumns=7,a.allLanes=Array.from(new Array(7).keys()),a.tickMs=8e3,a.laserFireMs=Math.floor(a.tickMs/a.tickMs*1e3),a.isAtGameEnd=!1,a.state=a.getInitialState(),a.handleInputChange=a.handleInputChange.bind(Object(g.a)(a)),a.tick=a.tick.bind(Object(g.a)(a)),a.advanceShipState=a.advanceShipState.bind(Object(g.a)(a)),a.fireAllChargingShips=a.fireAllChargingShips.bind(Object(g.a)(a)),a.getLetterInLane=a.getLetterInLane.bind(Object(g.a)(a)),a.projectLaserTarget=a.projectLaserTarget.bind(Object(g.a)(a)),a.laneToId=a.laneToId.bind(Object(g.a)(a)),a.destroyShip=a.destroyShip.bind(Object(g.a)(a)),a.getOppositeShip=a.getOppositeShip.bind(Object(g.a)(a)),a.fireLaser=a.fireLaser.bind(Object(g.a)(a)),a.haltLaser=a.haltLaser.bind(Object(g.a)(a)),a.checkEndGame=a.checkEndGame.bind(Object(g.a)(a)),a.getInitialState=a.getInitialState.bind(Object(g.a)(a)),a.reinitializeState=a.reinitializeState.bind(Object(g.a)(a)),a.replayPrompt=a.replayPrompt.bind(Object(g.a)(a)),a}return Object(u.a)(i,[{key:"getInitialState",value:function(){this.initialAllyShips={},this.initialEnemyShips={};var t,e=Object(o.a)(this.allLanes.values());try{for(e.s();!(t=e.n()).done;){var i=t.value,a=new O(!0,i);this.initialAllyShips[a.getId()]=a;var s=new O(!1,i);this.initialEnemyShips[s.getId()]=s}}catch(n){e.e(n)}finally{e.f()}return this.initialAllyShipStates={firingShips:[],chargingShips:[],idleShips:Array.from(Object.keys(this.initialAllyShips))},this.initialEnemyShipStates={firingShips:[],chargingShips:[],idleShips:Array.from(Object.keys(this.initialEnemyShips))},{input:"begin",allyShips:this.initialAllyShips,enemyShips:this.initialEnemyShips,allyShipStates:this.initialAllyShipStates,enemyShipStates:this.initialEnemyShipStates}}},{key:"reinitializeState",value:function(){this.setState(this.getInitialState())}},{key:"advanceShipState",value:function(t){var e,i,a;t.includes("ally")?(e=this.state.allyShips[t],i="allyShipStates",a="allyShips"):(e=this.state.enemyShips[t],i="enemyShipStates",a="enemyShips");var s,n,l=e.getState(),r=Object(c.a)({},this.state[a]);r[t].advanceState(),this.setState(Object(h.a)({},a,r)),"idle"===l?(n="idleShips",s="chargingShips"):"charging"===l?(n="chargingShips",s="firingShips"):(n="firingShips",s="idleShips");var o=this.state[i][n].indexOf(t),p=this.state[i][s],u=this.state[i][n];p.push(t),u.splice(o,1),this.setState(Object(h.a)({},[i][s],p)),this.setState(Object(h.a)({},[i][n],u))}},{key:"getLetterInLane",value:function(t){if("number"===typeof t)return(t>=this.allLanes.length||t<0)&&console.log("Error: out of bounds lane given to getLetterInLane"),this.state.input[t];console.log("Error: expected lane to be type number, but got",typeof t)}},{key:"getOppositeShip",value:function(t,e){var i=this.laneToId(t,!e),a=e?"enemyShips":"allyShips";return this.state[a][i]}},{key:"projectLaserTarget",value:function(t,e){var i=this.getLetterInLane(t);if(i&&-1===["a","e","i","o","u"].indexOf(i.toLowerCase()))return"consonant";var a=this.getOppositeShip(t,e);return"firing"===a.state?"otherBeam":a.isAlive()?"otherShip":"empty"}},{key:"haltLaser",value:function(t){var e,i;e=t.isAlly()?"allyShipStates":"enemyShipStates",i="idle"===t.getState()?"idleShips":"charging"===t.getState()?"chargingShips":"firingShips";var a=this.state[e][i].indexOf(t.getId()),s=this.state[e][i];s.splice(a,1),this.setState(Object(h.a)({},[e][i],s))}},{key:"replayPrompt",value:function(){var t,e=this.checkEndGame();e&&(clearInterval(this.timerID),"win"===e?t="Win!":"lose"===e?t="It's ok, try again!":"tie"===e&&(t="Tie, pretty good."),!1===this.isAtGameEnd&&(this.isAtGameEnd=!0,"y"===prompt(t+" Press y to play again")&&(window.location="https://gelafin.github.io/laser-lanes/")))}},{key:"destroyShip",value:function(t){this.sfx.explosion.play().catch((function(){console.log("\tERROR: explosion audio play() promise rejected. Click into the text box--or else this is localhost")})),t.destroy(),this.haltLaser(t)}},{key:"laneToId",value:function(t,e){return e?"ally"+t:"enemy"+t}},{key:"fireLaser",value:function(t){var e=this,i=t.getId(),a=t.getLane(),s=t.isAlly(),n=this.projectLaserTarget(a,s),l=!1;if("consonant"===n);else if("empty"===n);else if("otherShip"===n||"otherBeam"===n){var r=this.getOppositeShip(a,s);this.destroyShip(r),l=!0}this.sfx.firingLaser.play().catch((function(){console.log("\tERROR: firingLaser audio play() promise rejected. Click into the text box--or else this is localhost")})),setTimeout((function(){if(l){var a;console.log("\t\tretiring it from idle ships now"),e.haltLaser(t),a=i.includes("ally")?"allyShips":"enemyShips";var s=Object(c.a)({},e.state[a]);s[i].retire(),e.setState(Object(h.a)({},a,s))}else console.log("\t\tsetting it back to idle"),e.advanceShipState(i)}),this.laserFireMs)}},{key:"fireAllChargingShips",value:function(){var t,e=Object(o.a)(this.allLanes);try{for(e.s();!(t=e.n()).done;){var i=t.value,a=this.laneToId(i,!0),s=this.laneToId(i,!1),n=this.state.allyShips[a],l=this.state.enemyShips[s];"charging"!==n.getState()&&"charging"!==l.getState()||("charging"===n.getState()&&"charging"!==l.getState()?(this.advanceShipState(a),this.fireLaser(n)):"charging"===l.getState()&&"charging"!==n.getState()?(this.advanceShipState(s),this.fireLaser(l)):(this.advanceShipState(a),this.advanceShipState(s),this.fireLaser(n),this.fireLaser(l)))}}catch(r){e.e(r)}finally{e.f()}}},{key:"checkEndGame",value:function(){var t,e=0,i=0,a=Object(o.a)(this.allLanes);try{for(a.s();!(t=a.n()).done;){var s=t.value,n=this.laneToId(s,!0),l=this.laneToId(s,!1),r=this.state.allyShips[n],h=this.state.enemyShips[l];if(r.isAlive()&&h.isAlive())return null;r.isAlive()&&e++,h.isAlive()&&i++}}catch(c){a.e(c)}finally{a.f()}return e>i?"win":e<i?"lose":"tie"}},{key:"tick",value:function(){var t=this;console.log("----- ticking -----"),this.fireAllChargingShips(),this.replayPrompt(),!0!==this.isAtGameEnd&&this.setState((function(e){var i=y(0,e.allyShipStates.idleShips.length),a=y(0,e.enemyShipStates.idleShips.length),s=e.allyShipStates.idleShips[i],n=e.enemyShipStates.idleShips[a];"undefined"!==typeof s&&"undefined"!==typeof n&&(!1===e.allyShips[s].isAlive()||!1===e.enemyShips[n].isAlive()?console.log("********** charging"+s+" even though it's dead"):console.log("***** charging"+s+" and "+n),t.advanceShipState(s),t.advanceShipState(n),t.sfx.chargingLaser.play().catch((function(){console.log("\tERROR: chargingLaser audio play() promise rejected. Click into the text box--or else this is localhost")})))}),(function(){console.log(" > finished tick setState! Best to call advanceShipState here")}))}},{key:"componentDidMount",value:function(){var t=this;alert("Laser Lanes\n\nLasers fire automatically every "+Math.floor(this.tickMs/1e3)+" seconds. Lasers are blocked by consonants but pass through vowels, so please type words that will win"),this.timerID=setInterval((function(){return t.tick()}),this.tickMs),this.sfx={explosion:new Audio("./sfx/explosion.mp3"),chargingLaser:new Audio("./sfx/charging_laser.mp3"),firingLaser:new Audio("./sfx/firing_laser.mp3")},this.sfx.explosion.volume=.1,this.sfx.chargingLaser.volume=.1}},{key:"componentWillUnmount",value:function(){this.timerID&&clearInterval(this.timerID)}},{key:"handleInputChange",value:function(t){this.setState({input:t}),console.log("set input to ",t)}},{key:"render",value:function(){var t=this.maxColumns,e=new Array(t).fill(0).map((function(t,e){return e}));return Object(a.jsxs)("div",{className:"game-container flex-container",children:[Object(a.jsxs)("div",{className:"visuals-container",children:[Object(a.jsx)(m,{ships:this.state.enemyShips}),Object(a.jsx)(b,{output:this.state.input,reactKeys:e}),Object(a.jsx)(m,{ships:this.state.allyShips})]}),Object(a.jsx)("div",{children:Object(a.jsx)(j,{input:this.state.input,onInputChange:this.handleInputChange})})]})}}]),i}(n.a.Component),x=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,21)).then((function(e){var i=e.getCLS,a=e.getFID,s=e.getFCP,n=e.getLCP,l=e.getTTFB;i(t),a(t),s(t),n(t),l(t)}))};r.a.render(Object(a.jsx)(k,{}),document.getElementById("root")),x()}},[[20,1,2]]]);
//# sourceMappingURL=main.7e8dfc55.chunk.js.map